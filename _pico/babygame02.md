---
layout: post
title:  "babygame02"
grouped_by: picobin
---
### Description
> Break the game and get the flag.
Welcome to BabyGame 02! Navigate around the map and see what you can find! The game is available to download here. There is no source available, so you'll have to figure your way around the map. You can connect with it using nc saturn.picoctf.net 56660.

## Analysis

Opening the Executable in ghidra and reading through the main function, we get to see `move_player`
```c

/* WARNING: Function: __x86.get_pc_thunk.bx replaced with injection: get_pc_thunk_bx */

void move_player(int *param_1,char param_2,int param_3)

{
  int iVar1;
  
  if (param_2 == 'l') {
    iVar1 = getchar();
    player_tile = (undefined)iVar1;
  }
  if (param_2 == 'p') {
    solve_round(param_3,param_1);
  }
  *(undefined *)(*param_1 * 0x5a + param_3 + param_1[1]) = 0x2e;
  if (param_2 == 'w') {
    *param_1 = *param_1 + -1;
  }
  else if (param_2 == 's') {
    *param_1 = *param_1 + 1;
  }
  else if (param_2 == 'a') {
    param_1[1] = param_1[1] + -1;
  }
  else if (param_2 == 'd') {
    param_1[1] = param_1[1] + 1;
  }
  *(undefined *)(*param_1 * 0x5a + param_3 + param_1[1]) = player_tile;
  return;
}

```
We can also note that there is a `win` function in the code that opens a txt and displays the flag.
From initial analysis of move player, we see that there are no bound checks in place for the user position cordinates. Which means, we can give in negative index and use that to write data onto stack.
The offset of `win` is `0x0804975d` and `move_player` is `0x08049704`. So our idea is to overwrite the last byte of return address on stack to point to `win`.

## Solution

For overwriting the calue on stack, we need to now figure out the index to use. I ran the binary in gdb(gef). set a breakpoint where the position is being written in the index `*(undefined *)(*param_1 * 0x5a + param_3 + param_1[1]) = player_tile;`
I now calculated the difference between offset where the map is defined and the return address on stack, which gave me `0x27` or 39 in decimal.
So all we now have to do is go to the top of the map, change our player name to something else and then move 39 spaces to the right.


```
End tile position: 29 89
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
..........................................................................................
.........................................................................................X
s
s
picoCTF{gamer_jump1ng_4r0unD_84677fc1}
```

We get the flag `picoCTF{gamer_jump1ng_4r0unD_84677fc1}`